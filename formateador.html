<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <title>Formateador — textos → array por párrafo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    body {
      margin: 24px;
      color: #222;
    }

    .wrap {
      max-width: 900px;
      margin: 0 auto;
      display: grid;
      gap: 16px;
    }

    textarea,
    pre,
    code,
    input[type="text"] {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    }

    textarea {
      width: 100%;
      min-height: 220px;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    button {
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #ccc;
      cursor: pointer;
      background: #fff;
    }

    button+button {
      margin-left: 4px;
    }

    .out {
      min-height: 160px;
      white-space: pre;
      background: #0f172a;
      color: #e5e7eb;
      padding: 12px;
      border-radius: 10px;
      overflow: auto;
    }

    small.hint {
      color: #666;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <textarea id="entrada"
      placeholder="Pega o escribe el texto. Un párrafo nuevo se separa con una línea en blanco (doble salto). Dentro de un párrafo, 1×\n es salto de línea visual."></textarea>

    <div class="row">
      <button id="copiar">Copiar</button>
      <button id="limpiar">Limpiar</button>
      <button id="btnBold" title="Negrita (**)">B</button>
      <button id="btnItalic" title="Cursiva (*)">I</button>
      <button id="btnUnderline" title="Subrayado (__)">U</button>
      <button id="btnLink" title="Enlace [texto](url)">Link</button>
      <small class="hint">El resultado aparece abajo y se actualiza automáticamente.</small>
    </div>

    <div class="out" id="salida" aria-label="Salida JSON" tabindex="0"></div>
  </div>

  <script>
    const entrada = document.getElementById('entrada');
    const salida = document.getElementById('salida');
    const btnCopiar = document.getElementById('copiar');
    const btnLimpiar = document.getElementById('limpiar');

    function normalizarSaltos(s) {
      return s.replace(/\r\n?/g, '\n')
        .replace(/[ \t]+\n/g, '\n')
        .replace(/\n{3,}/g, '\n\n');
    }

    function jsonString(v) { return JSON.stringify(v); }

    function generar() {
      let text = entrada.value || '';
      text = normalizarSaltos(text);
      if (!text.trim()) { salida.textContent = ''; return; }

      const parrafos = text.trim().split(/\n\s*\n+/).map(p =>
        p.replace(/[ \t]+\n/g, '\n').replace(/\n{2,}/g, '\n').trim()
      ).filter(Boolean);

      const cuerpo = parrafos.map(p => '  ' + jsonString(p)).join(',\n');
      const json = `"textos": [\n${cuerpo}\n]`;
      salida.textContent = json;
    }

    btnCopiar.addEventListener('click', async () => {
      const txt = salida.textContent;
      if (!txt) return;
      try {
        await navigator.clipboard.writeText(txt);
        btnCopiar.textContent = '¡Copiado!';
        setTimeout(() => btnCopiar.textContent = 'Copiar', 1200);
      } catch {
        const range = document.createRange();
        range.selectNodeContents(salida);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
      }
    });

    btnLimpiar.addEventListener('click', () => {
      entrada.value = '';
      salida.textContent = '';
      entrada.focus();
    });

    function wrapSelection(before, after) {
      entrada.focus();
      const start = entrada.selectionStart;
      const end = entrada.selectionEnd;
      const value = entrada.value;
      const sel = value.slice(start, end) || '';
      const replaced = value.slice(0, start) + before + sel + after + value.slice(end);
      entrada.value = replaced;
      const newStart = start + before.length;
      const newEnd = newStart + sel.length;
      entrada.setSelectionRange(newStart, newEnd);
      generar();
    }

    function addLink() {
      entrada.focus();
      const start = entrada.selectionStart;
      const end = entrada.selectionEnd;
      let sel = entrada.value.slice(start, end).trim();
      const text = sel || prompt('Texto del enlace:', '');
      if (text === null) return;
      let url = prompt('URL (https:// o mailto:):', 'https://');
      if (url === null) return;
      url = url.replace(/^(https?):\s*\/\//i, '$1://').trim();
      if (!/^(https?:\/\/|mailto:)/i.test(url)) {
        alert('La URL debe empezar por https:// o mailto:');
        return;
      }
      const value = entrada.value;
      const replaced = value.slice(0, start) + `[${text}](${url})` + value.slice(end);
      entrada.value = replaced;
      const pos = start + (`[${text}](${url})`).length;
      entrada.setSelectionRange(pos, pos);
      generar();
    }

    const btnBold = document.getElementById('btnBold');
    const btnItalic = document.getElementById('btnItalic');
    const btnUnderline = document.getElementById('btnUnderline');
    const btnLinkFmt = document.getElementById('btnLink');

    btnBold.addEventListener('click', () => wrapSelection('**', '**'));
    btnItalic.addEventListener('click', () => wrapSelection('*', '*'));
    btnUnderline.addEventListener('click', () => wrapSelection('__', '__'));
    btnLinkFmt.addEventListener('click', addLink);

    entrada.addEventListener('input', generar);
    generar();
  </script>
</body>

</html>